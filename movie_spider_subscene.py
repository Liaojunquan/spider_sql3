# -*- coding: utf-8 -*-
# 该脚本用于爬取subscene网站的电影字幕
import time
import requests
import random
from lxml import etree
import sqlite3
import hashlib
import os
import logging
import zipfile
import chardet
from logging.handlers import TimedRotatingFileHandler
import rarfile
import platform
import sys
import json
import converter
import traceback

conn = sqlite3.connect('info.db')
cursor = conn.cursor()
subtitles_save_folder = '/data/movies2'    # 字幕文件和文件夹存放目录，仅支持绝对路径!
csv_file_path = './movies.csv'              # 存放电影imdb列表的csv文件位置，与脚本文件在同一目录下
proxy = {'http': '127.0.0.1:7890', 'https': '127.0.0.1:7890'}       # 代理地址，使用代理软件进行翻墙
USE_PROXY = False    # 是否使用代理的开关
is_save_error_file = True     # 是否保存非法的字幕文件，用于debug

language_dict = {                                          # 语言语种，不需要爬取的语种，使用#进行屏蔽
    "english": 'en', 'English subtitles': 'en',   # 英语
    "spanish": 'es',    # 西班牙语
    # "greek": 'el',      # 希腊语
    "arabic": 'ar',     # 阿拉伯
    # "chinese": 'zh', "chinese-bg-code": 'zh', "chinese (china)": 'zh', "chinese (hong kong sar)": 'zh',     # 中文
    # "chinese (taiwan)": 'zh', "chinese-china": 'zh', "chinese-hong kong sar": 'zh', "chinese-macau sar": 'zh',
    # "chinese-taiwan": 'zh', "chinese bg code": 'zh', "chinese (macau sar)": 'zh',
    # "dutch": 'nl', 'Nederlandse Ondertitels': 'nl',     # 荷兰语
    # "serbian": 'sr', "serbian-latin": 'sr', "serbian-cyrillic": 'sr',      # 塞尔维亚
    "brazilian portuguese": 'pt', "portuguese-br": 'pt', "portuguese": 'pt', "brazillian-portuguese": 'pt',  # 葡萄牙语
    "portuguese (br)": 'pt', "brazillian portuguese": 'pt', "brazilian": 'pt', "br": 'pt', "(br)": 'pt',    # (巴西)葡萄牙语
    # "croatian": 'hr',     # 克罗地亚语
    "french": 'fr',       # 法语
    # "turkish": 'tr',      # 土耳其
    # "indonesian": 'id',   # 印度尼西亚
    # "romanian": 'ro',     # 罗马尼亚语
    # "norwegian": 'no', "norwegian (bokmal)": 'no', "norwegian (nynorsk)": 'no', "norwegian-bokmal": 'no', "norwegian-nynorsk": 'no',  # 挪威
    # "bulgarian": 'bg',   # 保加利亚语
    # "farsi/persian": 'fa', "farsi_persia": 'fa', "farsi_persian": 'fa', "persian": 'fa', "farsi": 'fa',    # 波斯语
    # "hebrew": 'he',       # 希伯来语
    # "danish": 'da',       # 丹麦语
    # "hungarian": 'hu',    # 匈牙利
    # "finnish": 'fi', 'Suomi tekstitykset': 'fi',     # 芬兰语
    # "italian": 'it', "italian (switzerland)": 'it', "italian (italy)": 'it', "italian-switzerland": 'it', "italian-italy": 'it',   # 意大利语
    # "swedish": 'sv', 'Svenska undertexter': 'sv',   # 瑞典语
    # "malay": 'ms', "malay (brunei)": 'ms', "malay (malaysia)": 'ms', "malay-brunei": 'ms', "malay-malaysia": 'ms',   # 马来语
    # "slovenian": 'ls',    # 斯洛文尼亚语
    # "polish": 'pl',       # 波兰语
    # "bengali": 'bn',      # 孟加拉
    # "vietnamese": 'vi',   # 越南
    # "czech": 'cs', "chech": 'cs',   # 捷克语
    # "german": 'de',       # 德语
    # "russian": 'ru',      # 俄语
    # "macedonian": 'mk',   # 马其顿语
    # "thai": 'th',         # 泰国
    # "urdu": 'ur',         # 乌尔都语
    # "japanese": 'ja',     # 日文
    # "albanian": 'sq',     # 阿尔巴尼亚语
    # "korean": 'ko',       # 韩语
    # "lithuanian": 'lt',   # 立陶宛语
    # "bosnian": 'bs',      # 波斯尼亚语
    # "malayalam": 'ml',    # 马拉雅拉姆语
    # "icelandic": 'is',    # 冰岛语
    # "estonian": 'et',     # 爱沙尼亚语
    # "sundanese": 'su',    # 巽他语
    # "sinhala": 'si',      # 僧伽罗语
    # "hindi": 'hi',        # 印地语
    # "telugu": 'te',       # 泰卢固语
    # "galician": 'gl',     # 加利西亚
    # "afrikaans": 'af',    # 南非荷兰语
    # "armenian": 'hy',     # 亚美尼亚
    # "uzbek": 'uz',       # 乌兹别克语
    # "xhosa": 'xh',       # 科萨
    # "yiddish": 'yi',     # 意第绪语
    # "zulu": 'zu',        # 祖鲁
    # "assamese": 'as',    # 阿萨姆语
    # "azeri (latin)": 'az', "azeri (cyrillic)": 'az', "azeri-latin": 'az', "azeri-cyrillic": 'az', "azeri": 'az', 'azerbaijani': 'az',  # 阿塞拜疆语
    # "myanmar": 'mm', "burma": 'mm', "burmese": 'mm',     # 缅甸语
    # "basque": 'eu',      # 巴斯克
    # "belarusian": 'be',  # 白俄罗斯语
    # "catalan": 'ca',    # 加泰罗尼亚语
    # 'cambodian/khmer': 'kh', 'khmer': 'kh', 'cambodian': 'kh', 'cambodian-khmer': 'kh'   # 高棉语
    # "faeroese": 'fo',   # 法罗语
    # "gaelic": 'gd',     # 盖尔语
    # "georgian": 'ka',   # 格鲁吉亚
    # "gujarati": 'gu',   # 古吉拉特语
    # "kannada": 'kn',    # 卡纳达语
    # "kazakh": 'kk',     # 哈萨克语
    # "konkani": 'kok',   # 康卡尼
    # "kyrgyz": 'kz',     # 吉尔吉斯坦
    # "latvian": 'lv',    # 拉脱维亚语
    # "maltese": 'mt',    # 马耳他语
    # "marathi": 'mr',    # 马拉地语
    # "mongolian (cyrillic)": 'mn', "mongolian": 'mn'    # 蒙古语（西里尔文）
    # "nepali (india)": 'ne', 'nepali': 'ne',   # 尼泊尔语
    # "oriya": 'or',      # 奥里亚
    # "punjabi": 'pa',    # 旁遮普语
    # "sanskrit": 'sa',   # 梵文
    # "rhaeto-romanic": 'rm',   # 拉丁语
    # "slovak": 'sk',     # 斯洛伐克语
    # "sorbian": 'sb',    # 索布
    # "sutu": 'sx',
    # "swahili": 'sw',    # 斯瓦希里语
    # "syriac": 'syr',    # 叙利亚语
    # "tamil": 'tt',      # 泰米尔语
    # "tsonga": 'ts',
    # "tswana": 'tn',
    # "ukrainian": 'uk', 'ukranian': 'uk',   # 乌克兰文
    # 'kurdish': 'ku',    # 库尔德
    # 'yoruba': 'yo',     # 约鲁巴语
    # 'tagalog': 'tl',    # 他加禄语
    # 'occitan': 'oc',
    # 'pashto': 'ps',      # 普什图语
    # 'manipuri': 'mp'    # 曼尼普尔语
}

# ------------------------------以下内容非必要勿进行修改---------------------------------------------
if platform.python_version_tuple()[0] == '3' and int(platform.python_version_tuple()[1]) >= 8:  # python 3.8或以上版本
    sys.stdout.reconfigure(encoding='utf-8')    # 使print函数输出utf-8编码的字符串

logger = logging.getLogger('subscene_spider_log')  # 设置日志文件名
logger.setLevel(level=logging.INFO)
formatter = logging.Formatter('%(asctime)s - %(levelname)s - %(message)s')     # 设置日志输出内容
log_file_handler = TimedRotatingFileHandler(filename='subscene_spider_log', when='MIDNIGHT', interval=1, backupCount=20)  # 每日产生一个日志文件log，凌晨生成，超过20个自动删除最旧的
log_file_handler.setFormatter(formatter)
log_file_handler.setLevel(logging.INFO)
logger.addHandler(log_file_handler)

VERSION_LIST = ['74.0.3729.129', '76.0.3780.3', '76.0.3780.2', '74.0.3729.128', '76.0.3780.1', '76.0.3780.0', '75.0.3770.15', '74.0.3729.127', '74.0.3729.126', '76.0.3779.1', '76.0.3779.0', '75.0.3770.14', '74.0.3729.125', '76.0.3778.1', '76.0.3778.0', '75.0.3770.13', '74.0.3729.124', '74.0.3729.123', '73.0.3683.121', '76.0.3777.1', '76.0.3777.0', '75.0.3770.12', '74.0.3729.122', '76.0.3776.4', '75.0.3770.11', '74.0.3729.121', '76.0.3776.3', '76.0.3776.2', '73.0.3683.120', '74.0.3729.120', '74.0.3729.119', '74.0.3729.118', '76.0.3776.1', '76.0.3776.0', '76.0.3775.5', '75.0.3770.10', '74.0.3729.117', '76.0.3775.4', '76.0.3775.3', '74.0.3729.116', '75.0.3770.9', '76.0.3775.2', '76.0.3775.1', '76.0.3775.0', '75.0.3770.8', '74.0.3729.115', '74.0.3729.114', '76.0.3774.1', '76.0.3774.0', '75.0.3770.7', '74.0.3729.113', '74.0.3729.112', '74.0.3729.111', '76.0.3773.1', '76.0.3773.0', '75.0.3770.6', '74.0.3729.110', '74.0.3729.109', '76.0.3772.1', '76.0.3772.0', '75.0.3770.5', '74.0.3729.108', '74.0.3729.107', '76.0.3771.1', '76.0.3771.0', '75.0.3770.4', '74.0.3729.106', '74.0.3729.105', '75.0.3770.3', '74.0.3729.104', '74.0.3729.103', '74.0.3729.102', '75.0.3770.2', '74.0.3729.101', '75.0.3770.1', '75.0.3770.0', '74.0.3729.100', '75.0.3769.5', '75.0.3769.4', '74.0.3729.99', '75.0.3769.3', '75.0.3769.2', '75.0.3768.6', '74.0.3729.98', '75.0.3769.1', '75.0.3769.0', '74.0.3729.97', '73.0.3683.119', '73.0.3683.118', '74.0.3729.96', '75.0.3768.5', '75.0.3768.4', '75.0.3768.3', '75.0.3768.2', '74.0.3729.95', '74.0.3729.94', '75.0.3768.1', '75.0.3768.0', '74.0.3729.93', '74.0.3729.92', '73.0.3683.117', '74.0.3729.91', '75.0.3766.3', '74.0.3729.90', '75.0.3767.2', '75.0.3767.1', '75.0.3767.0', '74.0.3729.89', '73.0.3683.116', '75.0.3766.2', '74.0.3729.88', '75.0.3766.1', '75.0.3766.0', '74.0.3729.87', '73.0.3683.115', '74.0.3729.86', '75.0.3765.1', '75.0.3765.0', '74.0.3729.85', '73.0.3683.114', '74.0.3729.84', '75.0.3764.1', '75.0.3764.0', '74.0.3729.83', '73.0.3683.113', '75.0.3763.2', '75.0.3761.4', '74.0.3729.82', '75.0.3763.1', '75.0.3763.0', '74.0.3729.81', '73.0.3683.112', '75.0.3762.1', '75.0.3762.0', '74.0.3729.80', '75.0.3761.3', '74.0.3729.79', '73.0.3683.111', '75.0.3761.2', '74.0.3729.78', '74.0.3729.77', '75.0.3761.1', '75.0.3761.0', '73.0.3683.110', '74.0.3729.76', '74.0.3729.75', '75.0.3760.0', '74.0.3729.74', '75.0.3759.8', '75.0.3759.7', '75.0.3759.6', '74.0.3729.73', '75.0.3759.5', '74.0.3729.72', '73.0.3683.109', '75.0.3759.4', '75.0.3759.3', '74.0.3729.71', '75.0.3759.2', '74.0.3729.70', '73.0.3683.108', '74.0.3729.69', '75.0.3759.1', '75.0.3759.0', '74.0.3729.68', '73.0.3683.107', '74.0.3729.67', '75.0.3758.1', '75.0.3758.0', '74.0.3729.66', '73.0.3683.106', '74.0.3729.65', '75.0.3757.1', '75.0.3757.0', '74.0.3729.64', '73.0.3683.105', '74.0.3729.63', '75.0.3756.1', '75.0.3756.0', '74.0.3729.62', '73.0.3683.104', '75.0.3755.3', '75.0.3755.2', '73.0.3683.103', '75.0.3755.1', '75.0.3755.0', '74.0.3729.61', '73.0.3683.102', '74.0.3729.60', '75.0.3754.2', '74.0.3729.59', '75.0.3753.4', '74.0.3729.58', '75.0.3754.1', '75.0.3754.0', '74.0.3729.57', '73.0.3683.101', '75.0.3753.3', '75.0.3752.2', '75.0.3753.2', '74.0.3729.56', '75.0.3753.1', '75.0.3753.0', '74.0.3729.55', '73.0.3683.100', '74.0.3729.54', '75.0.3752.1', '75.0.3752.0', '74.0.3729.53', '73.0.3683.99', '74.0.3729.52', '75.0.3751.1', '75.0.3751.0', '74.0.3729.51', '73.0.3683.98', '74.0.3729.50', '75.0.3750.0', '74.0.3729.49', '74.0.3729.48', '74.0.3729.47', '75.0.3749.3', '74.0.3729.46', '73.0.3683.97', '75.0.3749.2', '74.0.3729.45', '75.0.3749.1', '75.0.3749.0', '74.0.3729.44', '73.0.3683.96', '74.0.3729.43', '74.0.3729.42', '75.0.3748.1', '75.0.3748.0', '74.0.3729.41', '75.0.3747.1', '73.0.3683.95', '75.0.3746.4', '74.0.3729.40', '74.0.3729.39', '75.0.3747.0', '75.0.3746.3', '75.0.3746.2', '74.0.3729.38', '75.0.3746.1', '75.0.3746.0', '74.0.3729.37', '73.0.3683.94', '75.0.3745.5', '75.0.3745.4', '75.0.3745.3', '75.0.3745.2', '74.0.3729.36', '75.0.3745.1', '75.0.3745.0', '75.0.3744.2', '74.0.3729.35', '73.0.3683.93', '74.0.3729.34', '75.0.3744.1', '75.0.3744.0', '74.0.3729.33', '73.0.3683.92', '74.0.3729.32', '74.0.3729.31', '73.0.3683.91', '75.0.3741.2', '75.0.3740.5', '74.0.3729.30', '75.0.3741.1', '75.0.3741.0', '74.0.3729.29', '75.0.3740.4', '73.0.3683.90', '74.0.3729.28', '75.0.3740.3', '73.0.3683.89', '75.0.3740.2', '74.0.3729.27', '75.0.3740.1', '75.0.3740.0', '74.0.3729.26', '73.0.3683.88', '73.0.3683.87', '74.0.3729.25', '75.0.3739.1', '75.0.3739.0', '73.0.3683.86', '74.0.3729.24', '73.0.3683.85', '75.0.3738.4', '75.0.3738.3', '75.0.3738.2', '75.0.3738.1', '75.0.3738.0', '74.0.3729.23', '73.0.3683.84', '74.0.3729.22', '74.0.3729.21', '75.0.3737.1', '75.0.3737.0', '74.0.3729.20', '73.0.3683.83', '74.0.3729.19', '75.0.3736.1', '75.0.3736.0', '74.0.3729.18', '73.0.3683.82', '74.0.3729.17', '75.0.3735.1', '75.0.3735.0', '74.0.3729.16', '73.0.3683.81', '75.0.3734.1', '75.0.3734.0', '74.0.3729.15', '73.0.3683.80', '74.0.3729.14', '75.0.3733.1', '75.0.3733.0', '75.0.3732.1', '74.0.3729.13', '74.0.3729.12', '73.0.3683.79', '74.0.3729.11', '75.0.3732.0', '74.0.3729.10', '73.0.3683.78', '74.0.3729.9', '74.0.3729.8', '74.0.3729.7', '75.0.3731.3', '75.0.3731.2', '75.0.3731.0', '74.0.3729.6', '73.0.3683.77', '73.0.3683.76', '75.0.3730.5', '75.0.3730.4', '73.0.3683.75', '74.0.3729.5', '73.0.3683.74', '75.0.3730.3', '75.0.3730.2', '74.0.3729.4', '73.0.3683.73', '73.0.3683.72', '75.0.3730.1', '75.0.3730.0', '74.0.3729.3', '73.0.3683.71', '74.0.3729.2', '73.0.3683.70', '74.0.3729.1', '74.0.3729.0', '74.0.3726.4', '73.0.3683.69', '74.0.3726.3', '74.0.3728.0', '74.0.3726.2', '73.0.3683.68', '74.0.3726.1', '74.0.3726.0', '74.0.3725.4', '73.0.3683.67', '73.0.3683.66', '74.0.3725.3', '74.0.3725.2', '74.0.3725.1', '74.0.3724.8', '74.0.3725.0', '73.0.3683.65', '74.0.3724.7', '74.0.3724.6', '74.0.3724.5', '74.0.3724.4', '74.0.3724.3', '74.0.3724.2', '74.0.3724.1', '74.0.3724.0', '73.0.3683.64', '74.0.3723.1', '74.0.3723.0', '73.0.3683.63', '74.0.3722.1', '74.0.3722.0', '73.0.3683.62', '74.0.3718.9', '74.0.3702.3', '74.0.3721.3', '74.0.3721.2', '74.0.3721.1', '74.0.3721.0', '74.0.3720.6', '73.0.3683.61', '72.0.3626.122', '73.0.3683.60', '74.0.3720.5', '72.0.3626.121', '74.0.3718.8', '74.0.3720.4', '74.0.3720.3', '74.0.3718.7', '74.0.3720.2', '74.0.3720.1', '74.0.3720.0', '74.0.3718.6', '74.0.3719.5', '73.0.3683.59', '74.0.3718.5', '74.0.3718.4', '74.0.3719.4', '74.0.3719.3', '74.0.3719.2', '74.0.3719.1', '73.0.3683.58', '74.0.3719.0', '73.0.3683.57', '73.0.3683.56', '74.0.3718.3', '73.0.3683.55', '74.0.3718.2', '74.0.3718.1', '74.0.3718.0', '73.0.3683.54', '74.0.3717.2', '73.0.3683.53', '74.0.3717.1', '74.0.3717.0', '73.0.3683.52', '74.0.3716.1', '74.0.3716.0', '73.0.3683.51', '74.0.3715.1', '74.0.3715.0', '73.0.3683.50', '74.0.3711.2', '74.0.3714.2', '74.0.3713.3', '74.0.3714.1', '74.0.3714.0', '73.0.3683.49', '74.0.3713.1', '74.0.3713.0', '72.0.3626.120', '73.0.3683.48', '74.0.3712.2', '74.0.3712.1', '74.0.3712.0', '73.0.3683.47', '72.0.3626.119', '73.0.3683.46', '74.0.3710.2', '72.0.3626.118', '74.0.3711.1', '74.0.3711.0', '73.0.3683.45', '72.0.3626.117', '74.0.3710.1', '74.0.3710.0', '73.0.3683.44', '72.0.3626.116', '74.0.3709.1', '74.0.3709.0', '74.0.3704.9', '73.0.3683.43', '72.0.3626.115', '74.0.3704.8', '74.0.3704.7', '74.0.3708.0', '74.0.3706.7', '74.0.3704.6', '73.0.3683.42', '72.0.3626.114', '74.0.3706.6', '72.0.3626.113', '74.0.3704.5', '74.0.3706.5', '74.0.3706.4', '74.0.3706.3', '74.0.3706.2', '74.0.3706.1', '74.0.3706.0', '73.0.3683.41', '72.0.3626.112', '74.0.3705.1', '74.0.3705.0', '73.0.3683.40', '72.0.3626.111', '73.0.3683.39', '74.0.3704.4', '73.0.3683.38', '74.0.3704.3', '74.0.3704.2', '74.0.3704.1', '74.0.3704.0', '73.0.3683.37', '72.0.3626.110', '72.0.3626.109', '74.0.3703.3', '74.0.3703.2', '73.0.3683.36', '74.0.3703.1', '74.0.3703.0', '73.0.3683.35', '72.0.3626.108', '74.0.3702.2', '74.0.3699.3', '74.0.3702.1', '74.0.3702.0', '73.0.3683.34', '72.0.3626.107', '73.0.3683.33', '74.0.3701.1', '74.0.3701.0', '73.0.3683.32', '73.0.3683.31', '72.0.3626.105', '74.0.3700.1', '74.0.3700.0', '73.0.3683.29', '72.0.3626.103', '74.0.3699.2', '74.0.3699.1', '74.0.3699.0', '73.0.3683.28', '72.0.3626.102', '73.0.3683.27', '73.0.3683.26', '74.0.3698.0', '74.0.3696.2', '72.0.3626.101', '73.0.3683.25', '74.0.3696.1', '74.0.3696.0', '74.0.3694.8', '72.0.3626.100', '74.0.3694.7', '74.0.3694.6', '74.0.3694.5', '74.0.3694.4', '72.0.3626.99', '72.0.3626.98', '74.0.3694.3', '73.0.3683.24', '72.0.3626.97', '72.0.3626.96', '72.0.3626.95', '73.0.3683.23', '72.0.3626.94', '73.0.3683.22', '73.0.3683.21', '72.0.3626.93', '74.0.3694.2', '72.0.3626.92', '74.0.3694.1', '74.0.3694.0', '74.0.3693.6', '73.0.3683.20', '72.0.3626.91', '74.0.3693.5', '74.0.3693.4', '74.0.3693.3', '74.0.3693.2', '73.0.3683.19', '74.0.3693.1', '74.0.3693.0', '73.0.3683.18', '72.0.3626.90', '74.0.3692.1', '74.0.3692.0', '73.0.3683.17', '72.0.3626.89', '74.0.3687.3', '74.0.3691.1', '74.0.3691.0', '73.0.3683.16', '72.0.3626.88', '72.0.3626.87', '73.0.3683.15', '74.0.3690.1', '74.0.3690.0', '73.0.3683.14', '72.0.3626.86', '73.0.3683.13', '73.0.3683.12', '74.0.3689.1', '74.0.3689.0', '73.0.3683.11', '72.0.3626.85', '73.0.3683.10', '72.0.3626.84', '73.0.3683.9', '74.0.3688.1', '74.0.3688.0', '73.0.3683.8', '72.0.3626.83', '74.0.3687.2', '74.0.3687.1', '74.0.3687.0', '73.0.3683.7', '72.0.3626.82', '74.0.3686.4', '72.0.3626.81', '74.0.3686.3', '74.0.3686.2', '74.0.3686.1', '74.0.3686.0', '73.0.3683.6', '72.0.3626.80', '74.0.3685.1', '74.0.3685.0', '73.0.3683.5', '72.0.3626.79', '74.0.3684.1', '74.0.3684.0', '73.0.3683.4', '72.0.3626.78', '72.0.3626.77', '73.0.3683.3', '73.0.3683.2', '72.0.3626.76', '73.0.3683.1', '73.0.3683.0', '72.0.3626.75', '71.0.3578.141', '73.0.3682.1', '73.0.3682.0', '72.0.3626.74', '71.0.3578.140', '73.0.3681.4', '73.0.3681.3', '73.0.3681.2', '73.0.3681.1', '73.0.3681.0', '72.0.3626.73', '71.0.3578.139', '72.0.3626.72', '72.0.3626.71', '73.0.3680.1', '73.0.3680.0', '72.0.3626.70', '71.0.3578.138', '73.0.3678.2', '73.0.3679.1', '73.0.3679.0', '72.0.3626.69', '71.0.3578.137', '73.0.3678.1', '73.0.3678.0', '71.0.3578.136', '73.0.3677.1', '73.0.3677.0', '72.0.3626.68', '72.0.3626.67', '71.0.3578.135', '73.0.3676.1', '73.0.3676.0', '73.0.3674.2', '72.0.3626.66', '71.0.3578.134', '73.0.3674.1', '73.0.3674.0', '72.0.3626.65', '71.0.3578.133', '73.0.3673.2', '73.0.3673.1', '73.0.3673.0', '72.0.3626.64', '71.0.3578.132', '72.0.3626.63', '72.0.3626.62', '72.0.3626.61', '72.0.3626.60', '73.0.3672.1', '73.0.3672.0', '72.0.3626.59', '71.0.3578.131', '73.0.3671.3', '73.0.3671.2', '73.0.3671.1', '73.0.3671.0', '72.0.3626.58', '71.0.3578.130', '73.0.3670.1', '73.0.3670.0', '72.0.3626.57', '71.0.3578.129', '73.0.3669.1', '73.0.3669.0', '72.0.3626.56', '71.0.3578.128', '73.0.3668.2', '73.0.3668.1', '73.0.3668.0', '72.0.3626.55', '71.0.3578.127', '73.0.3667.2', '73.0.3667.1', '73.0.3667.0', '72.0.3626.54', '71.0.3578.126', '73.0.3666.1', '73.0.3666.0', '72.0.3626.53', '71.0.3578.125', '73.0.3665.4', '73.0.3665.3', '72.0.3626.52', '73.0.3665.2', '73.0.3664.4', '73.0.3665.1', '73.0.3665.0', '72.0.3626.51', '71.0.3578.124', '72.0.3626.50', '73.0.3664.3', '73.0.3664.2', '73.0.3664.1', '73.0.3664.0', '73.0.3663.2', '72.0.3626.49', '71.0.3578.123', '73.0.3663.1', '73.0.3663.0', '72.0.3626.48', '71.0.3578.122', '73.0.3662.1', '73.0.3662.0', '72.0.3626.47', '71.0.3578.121', '73.0.3661.1', '72.0.3626.46', '73.0.3661.0', '72.0.3626.45', '71.0.3578.120', '73.0.3660.2', '73.0.3660.1', '73.0.3660.0', '72.0.3626.44', '71.0.3578.119', '73.0.3659.1', '73.0.3659.0', '72.0.3626.43', '71.0.3578.118', '73.0.3658.1', '73.0.3658.0', '72.0.3626.42', '71.0.3578.117', '73.0.3657.1', '73.0.3657.0', '72.0.3626.41', '71.0.3578.116', '73.0.3656.1', '73.0.3656.0', '72.0.3626.40', '71.0.3578.115', '73.0.3655.1', '73.0.3655.0', '72.0.3626.39', '71.0.3578.114', '73.0.3654.1', '73.0.3654.0', '72.0.3626.38', '71.0.3578.113', '73.0.3653.1', '73.0.3653.0', '72.0.3626.37', '71.0.3578.112', '73.0.3652.1', '73.0.3652.0', '72.0.3626.36', '71.0.3578.111', '73.0.3651.1', '73.0.3651.0', '72.0.3626.35', '71.0.3578.110', '73.0.3650.1', '73.0.3650.0', '72.0.3626.34', '71.0.3578.109', '73.0.3649.1', '73.0.3649.0', '72.0.3626.33', '71.0.3578.108', '73.0.3648.2', '73.0.3648.1', '73.0.3648.0', '72.0.3626.32', '71.0.3578.107', '73.0.3647.2', '73.0.3647.1', '73.0.3647.0', '72.0.3626.31', '71.0.3578.106', '73.0.3635.3', '73.0.3646.2', '73.0.3646.1', '73.0.3646.0', '72.0.3626.30', '71.0.3578.105', '72.0.3626.29', '73.0.3645.2', '73.0.3645.1', '73.0.3645.0', '72.0.3626.28', '71.0.3578.104', '72.0.3626.27', '72.0.3626.26', '72.0.3626.25', '72.0.3626.24', '73.0.3644.0', '73.0.3643.2', '72.0.3626.23', '71.0.3578.103', '73.0.3643.1', '73.0.3643.0', '72.0.3626.22', '71.0.3578.102', '73.0.3642.1', '73.0.3642.0', '72.0.3626.21', '71.0.3578.101', '73.0.3641.1', '73.0.3641.0', '72.0.3626.20', '71.0.3578.100', '72.0.3626.19', '73.0.3640.1', '73.0.3640.0', '72.0.3626.18', '73.0.3639.1', '71.0.3578.99', '73.0.3639.0', '72.0.3626.17', '73.0.3638.2', '72.0.3626.16', '73.0.3638.1', '73.0.3638.0', '72.0.3626.15', '71.0.3578.98', '73.0.3635.2', '71.0.3578.97', '73.0.3637.1', '73.0.3637.0', '72.0.3626.14', '71.0.3578.96', '71.0.3578.95', '72.0.3626.13', '71.0.3578.94', '73.0.3636.2', '71.0.3578.93', '73.0.3636.1', '73.0.3636.0', '72.0.3626.12', '71.0.3578.92', '73.0.3635.1', '73.0.3635.0', '72.0.3626.11', '71.0.3578.91', '73.0.3634.2', '73.0.3634.1', '73.0.3634.0', '72.0.3626.10', '71.0.3578.90', '71.0.3578.89', '73.0.3633.2', '73.0.3633.1', '73.0.3633.0', '72.0.3610.4', '72.0.3626.9', '71.0.3578.88', '73.0.3632.5', '73.0.3632.4', '73.0.3632.3', '73.0.3632.2', '73.0.3632.1', '73.0.3632.0', '72.0.3626.8', '71.0.3578.87', '73.0.3631.2', '73.0.3631.1', '73.0.3631.0', '72.0.3626.7', '71.0.3578.86', '72.0.3626.6', '73.0.3630.1', '73.0.3630.0', '72.0.3626.5', '71.0.3578.85', '72.0.3626.4', '73.0.3628.3', '73.0.3628.2', '73.0.3629.1', '73.0.3629.0', '72.0.3626.3', '71.0.3578.84', '73.0.3628.1', '73.0.3628.0', '71.0.3578.83', '73.0.3627.1', '73.0.3627.0', '72.0.3626.2', '71.0.3578.82', '71.0.3578.81', '71.0.3578.80', '72.0.3626.1', '72.0.3626.0', '71.0.3578.79', '70.0.3538.124', '71.0.3578.78', '72.0.3623.4', '72.0.3625.2', '72.0.3625.1', '72.0.3625.0', '71.0.3578.77', '70.0.3538.123', '72.0.3624.4', '72.0.3624.3', '72.0.3624.2', '71.0.3578.76', '72.0.3624.1', '72.0.3624.0', '72.0.3623.3', '71.0.3578.75', '70.0.3538.122', '71.0.3578.74', '72.0.3623.2', '72.0.3610.3', '72.0.3623.1', '72.0.3623.0', '72.0.3622.3', '72.0.3622.2', '71.0.3578.73', '70.0.3538.121', '72.0.3622.1', '72.0.3622.0', '71.0.3578.72', '70.0.3538.120', '72.0.3621.1', '72.0.3621.0', '71.0.3578.71', '70.0.3538.119', '72.0.3620.1', '72.0.3620.0', '71.0.3578.70', '70.0.3538.118', '71.0.3578.69', '72.0.3619.1', '72.0.3619.0', '71.0.3578.68', '70.0.3538.117', '71.0.3578.67', '72.0.3618.1', '72.0.3618.0', '71.0.3578.66', '70.0.3538.116', '72.0.3617.1', '72.0.3617.0', '71.0.3578.65', '70.0.3538.115', '72.0.3602.3', '71.0.3578.64', '72.0.3616.1', '72.0.3616.0', '71.0.3578.63', '70.0.3538.114', '71.0.3578.62', '72.0.3615.1', '72.0.3615.0', '71.0.3578.61', '70.0.3538.113', '72.0.3614.1', '72.0.3614.0', '71.0.3578.60', '70.0.3538.112', '72.0.3613.1', '72.0.3613.0', '71.0.3578.59', '70.0.3538.111', '72.0.3612.2', '72.0.3612.1', '72.0.3612.0', '70.0.3538.110', '71.0.3578.58', '70.0.3538.109', '72.0.3611.2', '72.0.3611.1', '72.0.3611.0', '71.0.3578.57', '70.0.3538.108', '72.0.3610.2', '71.0.3578.56', '71.0.3578.55', '72.0.3610.1', '72.0.3610.0', '71.0.3578.54', '70.0.3538.107', '71.0.3578.53', '72.0.3609.3', '71.0.3578.52', '72.0.3609.2', '71.0.3578.51', '72.0.3608.5', '72.0.3609.1', '72.0.3609.0', '71.0.3578.50', '70.0.3538.106', '72.0.3608.4', '72.0.3608.3', '72.0.3608.2', '71.0.3578.49', '72.0.3608.1', '72.0.3608.0', '70.0.3538.105', '71.0.3578.48', '72.0.3607.1', '72.0.3607.0', '71.0.3578.47', '70.0.3538.104', '72.0.3606.2', '72.0.3606.1', '72.0.3606.0', '71.0.3578.46', '70.0.3538.103', '70.0.3538.102', '72.0.3605.3', '72.0.3605.2', '72.0.3605.1', '72.0.3605.0', '71.0.3578.45', '70.0.3538.101', '71.0.3578.44', '71.0.3578.43', '70.0.3538.100', '70.0.3538.99', '71.0.3578.42', '72.0.3604.1', '72.0.3604.0', '71.0.3578.41', '70.0.3538.98', '71.0.3578.40', '72.0.3603.2', '72.0.3603.1', '72.0.3603.0', '71.0.3578.39', '70.0.3538.97', '72.0.3602.2', '71.0.3578.38', '71.0.3578.37', '72.0.3602.1', '72.0.3602.0', '71.0.3578.36', '70.0.3538.96', '72.0.3601.1', '72.0.3601.0', '71.0.3578.35', '70.0.3538.95', '72.0.3600.1', '72.0.3600.0', '71.0.3578.34', '70.0.3538.94', '72.0.3599.3', '72.0.3599.2', '72.0.3599.1', '72.0.3599.0', '71.0.3578.33', '70.0.3538.93', '72.0.3598.1', '72.0.3598.0', '71.0.3578.32', '70.0.3538.87', '72.0.3597.1', '72.0.3597.0', '72.0.3596.2', '71.0.3578.31', '70.0.3538.86', '71.0.3578.30', '71.0.3578.29', '72.0.3596.1', '72.0.3596.0', '71.0.3578.28', '70.0.3538.85', '72.0.3595.2', '72.0.3591.3', '72.0.3595.1', '72.0.3595.0', '71.0.3578.27', '70.0.3538.84', '72.0.3594.1', '72.0.3594.0', '71.0.3578.26', '70.0.3538.83', '72.0.3593.2', '72.0.3593.1', '72.0.3593.0', '71.0.3578.25', '70.0.3538.82', '72.0.3589.3', '72.0.3592.2', '72.0.3592.1', '72.0.3592.0', '71.0.3578.24', '72.0.3589.2', '70.0.3538.81', '70.0.3538.80', '72.0.3591.2', '72.0.3591.1', '72.0.3591.0', '71.0.3578.23', '70.0.3538.79', '71.0.3578.22', '72.0.3590.1', '72.0.3590.0', '71.0.3578.21', '70.0.3538.78', '70.0.3538.77', '72.0.3589.1', '72.0.3589.0', '71.0.3578.20', '70.0.3538.76', '71.0.3578.19', '70.0.3538.75', '72.0.3588.1', '72.0.3588.0', '71.0.3578.18', '70.0.3538.74', '72.0.3586.2', '72.0.3587.0', '71.0.3578.17', '70.0.3538.73', '72.0.3586.1', '72.0.3586.0', '71.0.3578.16', '70.0.3538.72', '72.0.3585.1', '72.0.3585.0', '71.0.3578.15', '70.0.3538.71', '71.0.3578.14', '72.0.3584.1', '72.0.3584.0', '71.0.3578.13', '70.0.3538.70', '72.0.3583.2', '71.0.3578.12', '72.0.3583.1', '72.0.3583.0', '71.0.3578.11', '70.0.3538.69', '71.0.3578.10', '72.0.3582.0', '72.0.3581.4', '71.0.3578.9', '70.0.3538.67', '72.0.3581.3', '72.0.3581.2', '72.0.3581.1', '72.0.3581.0', '71.0.3578.8', '70.0.3538.66', '72.0.3580.1', '72.0.3580.0', '71.0.3578.7', '70.0.3538.65', '71.0.3578.6', '72.0.3579.1', '72.0.3579.0', '71.0.3578.5', '70.0.3538.64', '71.0.3578.4', '71.0.3578.3', '71.0.3578.2', '71.0.3578.1', '71.0.3578.0', '70.0.3538.63', '69.0.3497.128', '70.0.3538.62', '70.0.3538.61', '70.0.3538.60', '70.0.3538.59', '71.0.3577.1', '71.0.3577.0', '70.0.3538.58', '69.0.3497.127', '71.0.3576.2', '71.0.3576.1', '71.0.3576.0', '70.0.3538.57', '70.0.3538.56', '71.0.3575.2', '70.0.3538.55', '69.0.3497.126', '70.0.3538.54', '71.0.3575.1', '71.0.3575.0', '71.0.3574.1', '71.0.3574.0', '70.0.3538.53', '69.0.3497.125', '70.0.3538.52', '71.0.3573.1', '71.0.3573.0', '70.0.3538.51', '69.0.3497.124', '71.0.3572.1', '71.0.3572.0', '70.0.3538.50', '69.0.3497.123', '71.0.3571.2', '70.0.3538.49', '69.0.3497.122', '71.0.3571.1', '71.0.3571.0', '70.0.3538.48', '69.0.3497.121', '71.0.3570.1', '71.0.3570.0', '70.0.3538.47', '69.0.3497.120', '71.0.3568.2', '71.0.3569.1', '71.0.3569.0', '70.0.3538.46', '69.0.3497.119', '70.0.3538.45', '71.0.3568.1', '71.0.3568.0', '70.0.3538.44', '69.0.3497.118', '70.0.3538.43', '70.0.3538.42', '71.0.3567.1', '71.0.3567.0', '70.0.3538.41', '69.0.3497.117', '71.0.3566.1', '71.0.3566.0', '70.0.3538.40', '69.0.3497.116', '71.0.3565.1', '71.0.3565.0', '70.0.3538.39', '69.0.3497.115', '71.0.3564.1', '71.0.3564.0', '70.0.3538.38', '69.0.3497.114', '71.0.3563.0', '71.0.3562.2', '70.0.3538.37', '69.0.3497.113', '70.0.3538.36', '70.0.3538.35', '71.0.3562.1', '71.0.3562.0', '70.0.3538.34', '69.0.3497.112', '70.0.3538.33', '71.0.3561.1', '71.0.3561.0', '70.0.3538.32', '69.0.3497.111', '71.0.3559.6', '71.0.3560.1', '71.0.3560.0', '71.0.3559.5', '71.0.3559.4', '70.0.3538.31', '69.0.3497.110', '71.0.3559.3', '70.0.3538.30', '69.0.3497.109', '71.0.3559.2', '71.0.3559.1', '71.0.3559.0', '70.0.3538.29', '69.0.3497.108', '71.0.3558.2', '71.0.3558.1', '71.0.3558.0', '70.0.3538.28', '69.0.3497.107', '71.0.3557.2', '71.0.3557.1', '71.0.3557.0', '70.0.3538.27', '69.0.3497.106', '71.0.3554.4', '70.0.3538.26', '71.0.3556.1', '71.0.3556.0', '70.0.3538.25', '71.0.3554.3', '69.0.3497.105', '71.0.3554.2', '70.0.3538.24', '69.0.3497.104', '71.0.3555.2', '70.0.3538.23', '71.0.3555.1', '71.0.3555.0', '70.0.3538.22', '69.0.3497.103', '71.0.3554.1', '71.0.3554.0', '70.0.3538.21', '69.0.3497.102', '71.0.3553.3', '70.0.3538.20', '69.0.3497.101', '71.0.3553.2', '69.0.3497.100', '71.0.3553.1', '71.0.3553.0', '70.0.3538.19', '69.0.3497.99', '69.0.3497.98', '69.0.3497.97', '71.0.3552.6', '71.0.3552.5', '71.0.3552.4', '71.0.3552.3', '71.0.3552.2', '71.0.3552.1', '71.0.3552.0', '70.0.3538.18', '69.0.3497.96', '71.0.3551.3', '71.0.3551.2', '71.0.3551.1', '71.0.3551.0', '70.0.3538.17', '69.0.3497.95', '71.0.3550.3', '71.0.3550.2', '71.0.3550.1', '71.0.3550.0', '70.0.3538.16', '69.0.3497.94', '71.0.3549.1', '71.0.3549.0', '70.0.3538.15', '69.0.3497.93', '69.0.3497.92', '71.0.3548.1', '71.0.3548.0', '70.0.3538.14', '69.0.3497.91', '71.0.3547.1', '71.0.3547.0', '70.0.3538.13', '69.0.3497.90', '71.0.3546.2', '69.0.3497.89', '71.0.3546.1', '71.0.3546.0', '70.0.3538.12', '69.0.3497.88', '71.0.3545.4', '71.0.3545.3', '71.0.3545.2', '71.0.3545.1', '71.0.3545.0', '70.0.3538.11', '69.0.3497.87', '71.0.3544.5', '71.0.3544.4', '71.0.3544.3', '71.0.3544.2', '71.0.3544.1', '71.0.3544.0', '69.0.3497.86', '70.0.3538.10', '69.0.3497.85', '70.0.3538.9', '69.0.3497.84', '71.0.3543.4', '70.0.3538.8', '71.0.3543.3', '71.0.3543.2', '71.0.3543.1', '71.0.3543.0', '70.0.3538.7', '69.0.3497.83', '71.0.3542.2', '71.0.3542.1', '71.0.3542.0', '70.0.3538.6', '69.0.3497.82', '69.0.3497.81', '71.0.3541.1', '71.0.3541.0', '70.0.3538.5', '69.0.3497.80', '71.0.3540.1', '71.0.3540.0', '70.0.3538.4', '69.0.3497.79', '70.0.3538.3', '71.0.3539.1', '71.0.3539.0', '69.0.3497.78', '68.0.3440.134', '69.0.3497.77', '70.0.3538.2', '70.0.3538.1', '70.0.3538.0', '69.0.3497.76', '68.0.3440.133', '69.0.3497.75', '70.0.3537.2', '70.0.3537.1', '70.0.3537.0', '69.0.3497.74', '68.0.3440.132', '70.0.3536.0', '70.0.3535.5', '70.0.3535.4', '70.0.3535.3', '69.0.3497.73', '68.0.3440.131', '70.0.3532.8', '70.0.3532.7', '69.0.3497.72', '69.0.3497.71', '70.0.3535.2', '70.0.3535.1', '70.0.3535.0', '69.0.3497.70', '68.0.3440.130', '69.0.3497.69', '68.0.3440.129', '70.0.3534.4', '70.0.3534.3', '70.0.3534.2', '70.0.3534.1', '70.0.3534.0', '69.0.3497.68', '68.0.3440.128', '70.0.3533.2', '70.0.3533.1', '70.0.3533.0', '69.0.3497.67', '68.0.3440.127', '70.0.3532.6', '70.0.3532.5', '70.0.3532.4', '69.0.3497.66', '68.0.3440.126', '70.0.3532.3', '70.0.3532.2', '70.0.3532.1', '69.0.3497.60', '69.0.3497.65', '69.0.3497.64', '70.0.3532.0', '70.0.3531.0', '70.0.3530.4', '70.0.3530.3', '70.0.3530.2', '69.0.3497.58', '68.0.3440.125', '69.0.3497.57', '69.0.3497.56', '69.0.3497.55', '69.0.3497.54', '70.0.3530.1', '70.0.3530.0', '69.0.3497.53', '68.0.3440.124', '69.0.3497.52', '70.0.3529.3', '70.0.3529.2', '70.0.3529.1', '70.0.3529.0', '69.0.3497.51', '70.0.3528.4', '68.0.3440.123', '70.0.3528.3', '70.0.3528.2', '70.0.3528.1', '70.0.3528.0', '69.0.3497.50', '68.0.3440.122', '70.0.3527.1', '70.0.3527.0', '69.0.3497.49', '68.0.3440.121', '70.0.3526.1', '70.0.3526.0', '68.0.3440.120', '69.0.3497.48', '69.0.3497.47', '68.0.3440.119', '68.0.3440.118', '70.0.3525.5', '70.0.3525.4', '70.0.3525.3', '68.0.3440.117', '69.0.3497.46', '70.0.3525.2', '70.0.3525.1', '70.0.3525.0', '69.0.3497.45', '68.0.3440.116', '70.0.3524.4', '70.0.3524.3', '69.0.3497.44', '70.0.3524.2', '70.0.3524.1', '70.0.3524.0', '70.0.3523.2', '69.0.3497.43', '68.0.3440.115', '70.0.3505.9', '69.0.3497.42', '70.0.3505.8', '70.0.3523.1', '70.0.3523.0', '69.0.3497.41', '68.0.3440.114', '70.0.3505.7', '69.0.3497.40', '70.0.3522.1', '70.0.3522.0', '70.0.3521.2', '69.0.3497.39', '68.0.3440.113', '70.0.3505.6', '70.0.3521.1', '70.0.3521.0', '69.0.3497.38', '68.0.3440.112', '70.0.3520.1', '70.0.3520.0', '69.0.3497.37', '68.0.3440.111', '70.0.3519.3', '70.0.3519.2', '70.0.3519.1', '70.0.3519.0', '69.0.3497.36', '68.0.3440.110', '70.0.3518.1', '70.0.3518.0', '69.0.3497.35', '69.0.3497.34', '68.0.3440.109', '70.0.3517.1', '70.0.3517.0', '69.0.3497.33', '68.0.3440.108', '69.0.3497.32', '70.0.3516.3', '70.0.3516.2', '70.0.3516.1', '70.0.3516.0', '69.0.3497.31', '68.0.3440.107', '70.0.3515.4', '68.0.3440.106', '70.0.3515.3', '70.0.3515.2', '70.0.3515.1', '70.0.3515.0', '69.0.3497.30', '68.0.3440.105', '68.0.3440.104', '70.0.3514.2', '70.0.3514.1', '70.0.3514.0', '69.0.3497.29', '68.0.3440.103', '70.0.3513.1', '70.0.3513.0', '69.0.3497.28']
UA_TMPL = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/%s Safari/537.36'
insert_sql = "insert into subtitle (imdb_id,moviename,language,languageShort,path) VALUES (?,?,?,?,?);"
select_sql = "select path from subtitle where imdb_id=? and language=?;"
select_all_sql = "select moviename from subtitle where imdb_id=? and language=? and path=?;"

session = requests.session()
url_set = set()
imdb_set = set()
not_found_count = 0


def print_and_log(msg):
    try:
        print(msg)
        logger.info(msg)
    except Exception as err:
        print('Error: Unable to print msg!!!')
        print(err)
        logger.info('Error: Unable to print msg!!!')
        logger.info(err)


def stander_header():     # 常规请求头
    return {
        'accept-encoding': 'gzip, deflate',
        'Accept-Language': 'zh-CN,zh;q=0.9',
        'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
        'sec-fetch-dest': 'document',
        'sec-fetch-mode': 'navigate',
        'sec-fetch-site': 'none',
        'sec-fetch-user': '?1',
        'upgrade-insecure-requests': '1',
        'User-Agent': UA_TMPL % random.choice(VERSION_LIST)
    }


def ajax_header():     # ajax请求头
    return {
        'accept-encoding': 'gzip, deflate',
        'Accept-Language': 'zh-CN,zh;q=0.9',
        'accept': 'application/json, text/plain, */*',
        'Host': 'v2.sg.media-imdb.com',
        'Origin': 'https://www.imdb.com',
        'Referer': 'https://www.imdb.com/',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'cross-site',
        'User-Agent': UA_TMPL % random.choice(VERSION_LIST)
    }


def download_header():
    return {
        'Accept-Language': 'zh-CN,zh;q=0.9',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
        'referer': 'https://subscene.com/subtitles/searchbytitle',
        'User-Agent': UA_TMPL % random.choice(VERSION_LIST)
    }


def get_response(url, my_header, quickly=False):
    if quickly:
        time.sleep(1)
    else:
        time.sleep(6)
    res = None
    count = 0
    while count < 3:    # 3次重连机会
        try:
            if USE_PROXY:
                res = session.get(url, headers=my_header, proxies=proxy, timeout=15)
            else:
                res = session.get(url, headers=my_header, timeout=15)
        except Exception as err:
            count += 1
            print_and_log(err)
            print_and_log('Retry again!  '+str(count))
            time.sleep(6)
            continue
        else:
            if res.status_code != 200:
                count += 1
                print_and_log('Status code is ' + str(res.status_code) + ' Retry again!  ' + str(count))
                if res.status_code == 403:
                    time.sleep(8)
                else:
                    time.sleep(6)
                continue
        if res is not None and res.status_code == 200:
            break
    if res is None or count >= 3:
        return None
    else:
        return res


def post_response(url, my_header, post_data):
    time.sleep(6)
    res = None
    count = 0
    while count < 3:     # 3次重连机会
        try:
            if USE_PROXY:
                res = session.post(url, headers=my_header, data=post_data, proxies=proxy, timeout=15)
            else:
                res = session.post(url, headers=my_header, data=post_data, timeout=15)
        except Exception as err:
            count += 1
            print_and_log('Post connect retry again! ' + str(count))
            print_and_log(err)
            time.sleep(6)
            continue
        else:
            if res.status_code != 200:
                count += 1
                print_and_log('Post status code is ' + str(res.status_code) + ' Retry again!  ' + str(count))
                if res.status_code == 403:
                    time.sleep(8)
                else:
                    time.sleep(6)
                continue
        if res is not None and res.status_code == 200:
            break
    if res is None or count >= 3:
        return None
    else:
        return res


def transform_encode(data):      # 字幕文件转码为utf-8
    try:
        encode = chardet.detect(data)
        str_encode = encode['encoding']
        if str_encode == 'MacCyrillic':
            str_encode = 'Windows-1256'
        if str_encode is not None:
            d = data.decode(str_encode, errors='ignore')
        else:
            try:
                d = data.decode('UTF-8')
            except:
                try:
                    d = data.decode('gbk')
                except:
                    try:
                        d = data.decode('gb2312')
                    except:
                        try:
                            d = data.decode('cp437')
                        except:
                            try:
                                d = data.decode('cp850')
                            except:
                                print_and_log('Error: No suitable charset encoding is available!')
                                return None
        d = d.replace('\r\n', '\n')
        tmp_list = []
        for each in d.split('\r'):
            tmp_list.append('\r\n'.join(each.split('\n')))
        d = '\r\n'.join(tmp_list)  # 统一转换为标准CRLF
        after = d.encode('UTF-8', errors='ignore')
    except Exception as err:
        print_and_log('Error in transform_encode!')
        print_and_log(err)
        return None
    else:
        return after


def file_name_translate(name):
    translate_name = None
    try:
        translate_name = name.replace('\u2019', '').encode('cp437', errors='ignore').decode('ascii', errors='ignore')
    except Exception as err:
        translate_name = None
        print_and_log('Error: No suitable charset encoding is available for file name!')
        print_and_log(err)
    return translate_name


def delete_special_char(name):
    # 去掉文件名中的括号和特殊字符
    return name.replace('(', '').replace(')', '').replace('[', '').replace(']', '').replace('{', '').replace('}', '') \
        .replace(' .', '.').replace('. ', '.').replace('?', '').replace('&', '').replace("'", '').replace('%20', '-') \
        .replace('`', '').replace('!', '').replace(',', '').replace('-_-', '-').replace('#', '').replace('+', '-') \
        .replace('%', '').replace('@', '').replace('!', '').replace('$', '').replace('^', '').replace('*', '') \
        .replace('~', '').replace('<', '').replace('>', '').replace('|', '').replace('"', '').replace('=', '') \
        .replace(';', '').replace(':', '').replace(' ', '-').replace('._.', '-').replace('.-.', '-') \
        .replace('-.-', '-').replace('--', '-').replace('..', '.').replace('__', '-').replace('_-_', '-')\
        .strip('.').strip('_').strip('-').strip()


def save_convert_error_file(data, file_name):
    if not is_save_error_file:
        return None
    try:
        if not os.path.exists(os.path.abspath('.') + '/error_file'):
            os.mkdir(os.path.abspath('.') + '/error_file')
        with open(os.path.abspath('.') + '/error_file/' + file_name, 'wb') as f:
            f.write(data)
    except Exception as err:
        print_and_log('Error: Unable save error file!')
        print_and_log(err)


def download_subtitles_file(url, language, imdb, mv_name, subtitle_id):
    file_name = url.split('/')[-1] + '.zip'
    count = 0
    res = None
    while count < 8:
        res = get_response(url, my_header=download_header(), quickly=True)  # 下载字幕文件压缩包
        if res is None or res.status_code != 200:
            count += 1
            if res is not None:
                print_and_log('Status Code is ' + str(res.status_code))
            print_and_log(str(count) + '  Unable to download subtitles file!  ' + url)
            session.cookies.clear()
            # time.sleep(1)
            continue
        else:
            count = 0
            break
    if res is None or count >= 8:
        return None
    try:
        with open(os.path.join(subtitles_save_folder, 'tmp', file_name), 'wb') as f:       # 字幕zip包保存到/data/movies/tmp目录下
            f.write(res.content)
    except Exception as err:
        print_and_log('Error: Unable save compress file to disk!!!')
        print_and_log(err)
        return None
    try:
        zip_file = zipfile.ZipFile(os.path.join(subtitles_save_folder, 'tmp', file_name), 'r')  # 尝试使用zip打开压缩包
    except:
        try:
            zip_file = rarfile.RarFile(os.path.join(subtitles_save_folder, 'tmp', file_name), 'r')  # 不成功，则尝试使用rar打开压缩包
        except Exception as err:
            print_and_log('Error: Unable to open compress file!!!')
            print_and_log(err)
            return None
    for srt_file_name in zip_file.namelist():     # 遍历压缩包内所有文件的文件名称
        srt_file = file_name_translate(srt_file_name)        # 文件名去除非ASC-II编码的字符
        if srt_file is None:
            continue
        if '/' in srt_file:  # 文件名带有目录的情况
            srt_file = delete_special_char(srt_file[srt_file.rfind('/') + 1:].replace('\\', ''))
        elif '\\' in srt_file:  # 文件名带有目录的情况
            srt_file = delete_special_char(srt_file[srt_file.rfind('\\') + 1:].replace('/', ''))
        else:  # 文件名不带有目录
            srt_file = delete_special_char(srt_file)
        try:
            srt_file = srt_file[:-4] + srt_file[-4:].lower()      # 后缀统一转小写
        except:
            pass
        is_error_file = False
        if srt_file.endswith('.jpg') or srt_file.endswith('.rar') or srt_file.endswith('.nfo') or \
                srt_file.endswith('.idx') or srt_file.endswith('.torrent') or srt_file.endswith('.zip') or \
                srt_file.endswith('.doc') or srt_file.endswith('.db'):     # 跳过非字幕文件
            continue
        if '.' in srt_file and not srt_file.endswith('.srt') and not srt_file.endswith('.ass') and \
                not srt_file.endswith('.smi') and not srt_file.endswith('.sub') and not srt_file.endswith('.ssa') and \
                not srt_file.endswith('.txt') and not srt_file.endswith('-srt') and not srt_file.endswith('-lol'):      # 不是指定后缀的文件，则跳过
            print_and_log('Not a subtitle file:  ' + srt_file)
            is_error_file = True
        language_short = language_dict.get(language)     # 获取语言缩写
        file_path = os.path.join(subtitles_save_folder, imdb, language.replace(' ', '_').replace('/', '_'))   # 字幕文件最终存放路径
        if language_short is not None:
            file_path = os.path.join(subtitles_save_folder, imdb, language_short)   # 字幕文件最终存放路径
            if not os.path.exists(file_path):  # 创建语言文件夹，存放指定语言的字幕文件
                os.mkdir(file_path)
        else:
            continue
        try:
            data = zip_file.read(srt_file_name)  # 根据文件名从zip包读取指定文件
        except Exception as err:
            print_and_log('Error: Unable to read file from compress file! (no replace)')
            print_and_log(err)
            try:
                data = zip_file.read(srt_file_name.replace('/', '\\'))  # 根据文件名从zip包读取指定文件
            except Exception as err:
                print_and_log('Error: Unable to read file from compress file! (replace /)')
                print_and_log(err)
                try:
                    data = zip_file.read(srt_file_name.replace('\\', '/'))  # 根据文件名从zip包读取指定文件
                except Exception as err:
                    print_and_log('Error: Unable to read file from compress file! (replace \\)')
                    print_and_log(err)
                    continue
        if len(data) < 1000 * 10:  # 数据小于10KB
            # print_and_log('Subtitle file data too small: ' + srt_file + '  ' + str(len(data) / 1000) + 'KB')
            # save_convert_error_file(data, srt_file)
            continue
        if is_error_file:
            # save_convert_error_file(data, srt_file)
            # continue
            pass
        data = transform_encode(data)
        if data is None:        # 字幕文件不成功转码为utf-8，则放弃
            continue
        file_format = converter.check_file_format(data)
        if 'unknown' in file_format:  # 非字幕文件格式文件，跳过
            print_and_log('Error: this subtitle file format is unknown!!!  ' + srt_file)
            save_convert_error_file(data, srt_file)
            continue
        elif file_format == 'srt':  # srt字幕文件
            data_tmp = converter.convertSRT(data)
            if type(data_tmp) == str:
                print_and_log('Error: Unable to standardized srt file, ' + data_tmp + '  ' + srt_file)
                save_convert_error_file(data, srt_file)
                continue
            data = data_tmp
            srt_file = srt_file[:srt_file.rfind('.')] + '.srt'
            srt_file_new = file_path + '/' + subtitle_id + '-' + srt_file     # 新文件绝对路径
        elif file_format == 'ass':  # ass字幕文件
            data_tmp = converter.convertASS(data)
            if type(data_tmp) == str:
                print_and_log('Error: Unable to convert ass file to srt file, ' + data_tmp + '  ' + srt_file)
                save_convert_error_file(data, srt_file)
                continue
            data = data_tmp
            srt_file = srt_file[:srt_file.rfind('.')] + '.ass'
            srt_file_new = file_path + '/' + subtitle_id + '-' + srt_file + '.srt'  # 新文件绝对路径
        elif file_format == 'smi':  # smi字幕文件
            data_tmp = converter.convertSMI(data)
            if type(data_tmp) == str:
                print_and_log('Error: Unable to convert smi file to srt file, ' + data_tmp + '  ' + srt_file)
                save_convert_error_file(data, srt_file)
                continue
            data = data_tmp
            srt_file = srt_file[:srt_file.rfind('.')] + '.smi'
            srt_file_new = file_path + '/' + subtitle_id + '-' + srt_file + '.srt'  # 新文件绝对路径
        elif file_format == 'sub':  # sub字幕文件
            data_tmp = converter.convertSUB(data)
            if type(data_tmp) == str:
                print_and_log('Error: Unable to convert sub file to srt file, ' + data_tmp + '  ' + srt_file)
                save_convert_error_file(data, srt_file)
                continue
            data = data_tmp
            srt_file = srt_file[:srt_file.rfind('.')] + '.sub'
            srt_file_new = file_path + '/' + subtitle_id + '-' + srt_file + '.srt'  # 新文件绝对路径
        elif file_format == 'other':            # 其它字幕文件
            data_tmp = converter.check(data)
            if type(data_tmp) == str:
                print_and_log('Error: Unable to convert this file to srt file, ' + data_tmp + '  ' + srt_file)
                save_convert_error_file(data, srt_file)
                continue
            data = data_tmp
            # srt_file = srt_file[:srt_file.rfind('.')] + '.sub'
            srt_file_new = file_path + '/' + subtitle_id + '-' + srt_file + '.srt'  # 新文件绝对路径
        else:
            continue
        md5_this = None
        try:
            if type(data) == list:
                md5_this = hashlib.md5(data[0]).hexdigest()
            else:
                md5_this = hashlib.md5(data).hexdigest()
        except Exception as err:
            print_and_log('Error: 1---Unable to get file MD5!  '+srt_file)
            print_and_log(err)
            continue
        if md5_this is None:
            print_and_log('Error: 1---Unable to get file MD5!  ' + srt_file)
            continue
        result = ()
        try:
            cursor.execute(select_sql, (imdb, language))      # 从数据库查询所有该电影、该语种的字幕文件路径
            result = cursor.fetchall()
        except Exception as err:
            print_and_log('Error: Unable to get data from DB!!! Unable to compare the subtitle file MD5 value!')
            print_and_log(err)
            continue
        is_exist = False    # 字幕文件是否已存在，默认为否
        for each_result in result:     # 分别比较已存在的文件与现在下载的文件的MD5值
            path = each_result[0]
            try:
                with open(path, 'rb') as f:           # 读取文件，获取其MD5值
                    md5_result = hashlib.md5(f.read()).hexdigest()
            except Exception as err:
                print_and_log('Error: 2---Unable to get file MD5, skip this file!  ' + each_result[0])
                print_and_log(err)
                continue
            if md5_result is None:
                print_and_log('Error: 2---Unable to get file MD5, skip this file!  ' + each_result[0])
                continue
            if md5_this == md5_result:    # MD5相同，即为相同字幕文件
                is_exist = True
                # print_and_log('<< '+mv_name+' >> '+language+' '+season_and_episode+' '+srt_file_new.split('/')[-1]+' is existed on Disk!!!')
                break
        if is_exist:   # 文件存在则跳过
            continue
        result = ()
        try:
            if type(data) == list:
                cursor.execute(select_all_sql,
                               (imdb, language, srt_file_new.replace('.sub.srt', '') + '-23.976fps.sub.srt'))
            else:
                cursor.execute(select_all_sql, (imdb, language, srt_file_new))  # 查询数据库是否已有该文件名称的电影记录
            result = cursor.fetchall()
        except Exception as err:
            print_and_log('Error: Unable to get data from DB, Unable to check this subtitle data existed or not on DB!')
            print_and_log(err)
            continue
        if len(result) > 0:  # 有该文件名称的电影记录
            random_code = format(int(str(time.time()).replace('.', '') + str(random.randint(0, 100))), 'x')
            if srt_file_new.endswith('.ass.srt'):
                srt_file_new = srt_file_new.replace('.ass.srt', '') + '-' + random_code + '.ass.srt'  # 文件名增加随机码，以避开相同文件名
            elif srt_file_new.endswith('.smi.srt'):
                srt_file_new = srt_file_new.replace('.smi.srt', '') + '-' + random_code + '.smi.srt'
            elif srt_file_new.endswith('.sub.srt'):
                srt_file_new = srt_file_new.replace('.sub.srt', '') + '-' + random_code + '.sub.srt'
            else:
                srt_file_new = srt_file_new.replace('.srt', '') + '-' + random_code + '.srt'  # 文件名增加随机码，以避开相同文件名
        try:
            if type(data) == list:
                cursor.execute(insert_sql, (imdb, mv_name, language, language_short,
                                            srt_file_new.replace('.sub.srt', '') + '-23.976fps.sub.srt'))  # 插入数据库
                cursor.execute(insert_sql, (imdb, mv_name, language, language_short,
                                            srt_file_new.replace('.sub.srt', '') + '-24fps.sub.srt'))  # 插入数据库
                cursor.execute(insert_sql, (imdb, mv_name, language, language_short,
                                            srt_file_new.replace('.sub.srt', '') + '-25fps.sub.srt'))  # 插入数据库
            else:
                cursor.execute(insert_sql, (imdb, mv_name, language, language_short, srt_file_new))  # 插入数据库
            conn.commit()
        except Exception as err:
            print_and_log('Error: Unable insert data to DB!!!')
            print_and_log(err)
            continue
        try:
            if type(data) == list:
                with open(srt_file_new.replace('.sub.srt', '') + '-23.976fps.sub.srt', 'wb') as f:
                    f.write(data[0])
                with open(srt_file_new.replace('.sub.srt', '') + '-24fps.sub.srt', 'wb') as f:
                    f.write(data[1])
                with open(srt_file_new.replace('.sub.srt', '') + '-25fps.sub.srt', 'wb') as f:
                    f.write(data[2])
            else:
                with open(srt_file_new, 'wb') as f:
                    f.write(data)
        except Exception as err:
            print_and_log('Error: Unable save subtitle file to disk!!!')
            print_and_log(err)
            continue
        print_and_log('********<< ' + mv_name + ' >> ' + language + ' ' + srt_file_new.split('/')[-1] + ' is successfully insert to DB!')

    try:
        zip_file.close()     # 关闭压缩文件
    except Exception as err:
        print_and_log('Error: Unable to close compress file!!!  '+os.path.join(subtitles_save_folder, 'tmp', file_name))
        print_and_log(err)
    try:
        for each_compress_file in os.listdir(os.path.join(subtitles_save_folder, 'tmp')):
            os.remove(os.path.join(subtitles_save_folder, 'tmp', each_compress_file))        # 删除tmp目录下压缩包和字幕文件，节约空间
    except Exception as err:
        print_and_log('Error: Unable to delete compress file and subtitle file!!!')
        print_and_log(err)


def search_movies(mv_name, imdb_list, imdb_list_index):
    post_data = {'query': mv_name, 'l': ''}
    header_subscene = {
        'referer': 'https://subscene.com/subtitles/searchbytitle',
        'origin': 'https://subscene.com',
        'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
        'accept-language': 'en',
        'accept-encoding': 'gzip, deflate',
        'ec-fetch-dest': 'document',
        'sec-fetch-mode': 'navigate',
        'sec-fetch-site': 'same-origin',
        'sec-fetch-user': '?1',
        'upgrade-insecure-requests': '1',
        'user-agent': UA_TMPL % random.choice(VERSION_LIST)
    }
    h2 = None
    uls = None
    count = 0
    while count < 5:
        res = post_response('https://subscene.com/subtitles/searchbytitle', header_subscene, post_data)  # 使用subscene网站进行搜索
        if res is None or res.status_code != 200:
            if res is not None:
                print_and_log('Status Code is ' + str(res.status_code))
            print_and_log(str(count)+'  Error: Unable to search: << '+mv_name+' >> in subscene.com  '+imdb_list[imdb_list_index])
            session.cookies.clear()
            # time.sleep(6)
            count += 1
            continue
        html = etree.HTML(res.text)
        h2 = html.xpath('//div[@class="search-result"]/h2/text()')  # 获取标题(电影名称)
        uls = html.xpath('//div[@class="search-result"]/ul')  # 获取ul标签
        if h2 is None or uls is None or len(h2) == 0 or len(uls) == 0 or len(h2) != len(uls):
            print_and_log(str(count)+'  Error: Unable to get all movies subtitles title!!!  '+imdb_list[imdb_list_index])
            break
            # time.sleep(6)
            # count += 1
            # continue
        else:
            break
    if count >= 5 or h2 is None or uls is None:
        return False
    lis = []
    for i in range(len(h2)):
        if h2[i] == 'Exact' or h2[i] == 'Close':    # 仅获取Exact和Close的标题
            lis += uls[i].xpath('./li')
    if len(lis) == 0:
        for i in range(len(h2)):
            lis += uls[i].xpath('./li')     # 获取全部的标题
    if len(lis) == 0:
        print_and_log('Error: Unable to get lis!!!  ' + imdb_list[imdb_list_index] + '  << ' + mv_name + ' >>')
        return False
    li_index = 0
    schedule = 0          # 每一个电影字幕文件的爬取进度
    is_not_found = True   # 是否找到指定imdb的电影，默认为否
    while li_index < len(lis):
        schedule += 1
        print_and_log('<< ' + mv_name + ' >>  schedule now is: ' + str(int(schedule / len(lis) * 100)) + '%')
        href = lis[li_index].xpath('.//a/@href')
        if href is None or len(href) == 0:
            print_and_log('Unable to get subtitles detail page url!  ' + mv_name)
            li_index += 1
            continue
        mv_url = 'https://subscene.com' + href[0]
        if mv_url in url_set:
            li_index += 1
            continue
        res = get_response(mv_url, my_header=header_subscene, quickly=True)  # 打开该电影字幕详情页面
        if res is None or res.status_code != 200:
            if res is not None:
                print_and_log('Status Code is ' + str(res.status_code))
            print_and_log('Unable to open page ' + mv_url + '  ' + imdb_list[imdb_list_index])
            li_index += 1
            continue
        url_set.add(mv_url)            # 设置该url已被访问过
        html = etree.HTML(res.text)
        imdb = html.xpath('//h2/a[@class="imdb"]/@href')
        if imdb is None or len(imdb) == 0:
            # print_and_log('Unable to get imdb, jump this!!!')
            li_index += 1
            continue
        imdb = imdb[0].split('/')[-1]
        if 'tt' not in imdb:
            li_index += 1
            continue  # 不是imdb，跳过
        try:
            imdb_tmp = str(int(imdb.replace('tt', '')))
        except Exception:  # imdb异常或不标准
            li_index += 1
            continue
        else:
            if len(imdb_tmp) > 8:  # imdb位数大于8，非正常imdb
                li_index += 1
                continue
            elif len(imdb_tmp) < 7:  # imdb位数小于7，补够7位
                imdb = 'tt' + '0' * (7 - len(imdb_tmp)) + imdb_tmp
            else:  # 7位或8位，正常imdb
                imdb = 'tt' + imdb_tmp
        if imdb not in imdb_list:
            li_index += 1
            continue  # 不是指定imdb的电影字幕，跳过
        else:
            is_not_found = False  # 是指定imdb的电视剧字幕
        a_s = html.xpath('//div[@class="content clearfix"]//tr/td[@class="a1"]/a')  # 获取页面上的字幕列表
        a_index = 0
        while a_index < len(a_s):  # 遍历字幕列表每一个字幕
            language = a_s[a_index].xpath('./span[1]/text()')  # 获取字幕语言
            file_page_url = a_s[a_index].xpath('./@href')  # 获取字幕下载详情页地址
            if file_page_url is None or language is None or len(file_page_url) == 0 or len(language) == 0:
                print_and_log('Error: Unable to get subtitle title!')
                a_index += 1
                continue
            language = language[0].replace('\r', '').replace('\n', '').replace('\t', '').replace('\xa0', '').strip().lower()
            if '/' in language:
                language_tmp = language.split('/')
                for each_language in language_tmp:
                    if each_language.strip() != 'english':
                        language = each_language.strip()
                        break
            if ' code' in language:
                a_index += 1
                continue
            elif language_dict.get(language) is None:
                print_and_log('Error: Unable to get language short: ' + language)
                a_index += 1
                continue
            file_page_url = 'https://subscene.com' + file_page_url[0].replace('\r', '').replace('\n', '').replace('\t', '').replace('\xa0', '').strip()
            subtitle_id = file_page_url.split('/')[-1]  # 获取该字幕的id
            count = 0
            download_url = None
            while count < 8:
                res = get_response(file_page_url, my_header=stander_header(), quickly=True)  # 打开字幕下载详情页面
                if res is None or res.status_code != 200:
                    if res is not None:
                        print_and_log('Status Code is ' + str(res.status_code))
                    print_and_log(str(count) + '  Unable to open subtitles download page!  ' + file_page_url)
                    session.cookies.clear()
                    count += 1
                    # time.sleep(6)
                    continue
                html = etree.HTML(res.text)
                download_url = html.xpath('//a[@id="downloadButton"]/@href')  # 获取字幕下载地址
                if download_url is None or len(download_url) == 0:
                    print_and_log(str(count) + '  Unable to get subtitle download url!!!  ' + file_page_url)
                    count += 1
                    # time.sleep(6)
                    continue
                else:
                    break
            if count >= 8 or download_url is None or len(download_url) == 0:
                a_index += 1
                continue
            download_url = 'https://subscene.com' + download_url[0]
            if not os.path.exists(os.path.join(subtitles_save_folder, imdb_list[imdb_list_index])):  # 创建该电影的文件夹
                os.mkdir(os.path.join(subtitles_save_folder, imdb_list[imdb_list_index]))
            download_subtitles_file(download_url, language, imdb_list[imdb_list_index], mv_name, subtitle_id)  # 下载字幕文件zip包，并进行比较、转码和入库
            a_index += 1
        li_index += 1
    return not is_not_found


def main():
    global not_found_count
    os.makedirs(os.path.join(subtitles_save_folder, 'tmp'), exist_ok=True)
    csv_file = open(csv_file_path, 'r')    # 读取csv文件
    imdb_str = csv_file.read()
    csv_file.close()
    imdb_list = imdb_str.split('\n')    # 获取csv文件中的所有电视剧imdb
    imdb_list_index = 0
    while 1:
        if not_found_count > 80:  # 连续80个imdb找不到结果，则说明可以结束了
            return None
        while 1:
            imdb_list_index = random.randint(0, len(imdb_list))   # 随机取一个imdb
            if imdb_list_index not in imdb_set and 0 <= imdb_list_index < len(imdb_list):
                break
        print_and_log('IMDB set now is: ' + str(int(len(imdb_set) / len(imdb_list) * 100)) + '%')
        print_and_log('IMDB now is '+imdb_list[imdb_list_index])
        # print_and_log('IMDB schedule is ' + str(int((imdb_list_index + 1) / len(imdb_list) * 100)) + '%')
        imdb_url = 'https://www.imdb.com/title/' + imdb_list[imdb_list_index] + '/'
        res = get_response(imdb_url, my_header=stander_header(), quickly=True)     # 搜索IMDB网站获取imdb对应的电影名称
        if res is None or res.status_code != 200:
            if res is not None:
                print_and_log('Status Code is ' + str(res.status_code))
            print_and_log('Error: Unable to get IMDB page response!')
            # imdb_list_index += 1
            continue
        html = etree.HTML(res.text)
        mv_name = html.xpath('//h1/text()')      # 获取电影名称
        if mv_name is None or len(mv_name) == 0:
            print_and_log('Error: Unable to get this movie name!  ' + imdb_url)
            # imdb_list_index += 1
            continue
        mv_name = ''.join(mv_name).replace('\n', '').replace('\r', '').replace('\t', '').replace('\xa0', '').strip()   # 获取imdb对应的电影名称
        is_found = search_movies(mv_name, imdb_list, imdb_list_index)
        if not is_found:
            imdb_url = 'https://v2.sg.media-imdb.com/suggestion/t/' + imdb_list[imdb_list_index] + '.json'
            mv_name_ajax = None
            res = get_response(imdb_url, my_header=ajax_header(), quickly=True)
            if res is None or res.status_code != 200:
                if res is not None:
                    print_and_log('Status Code is ' + str(res.status_code))
                print_and_log('Error: Unable to get IMDB ajax response!')
            else:
                try:
                    json_dict = json.loads(res.text)
                    mv_name_ajax = json_dict['d'][0]['l']
                except Exception as err:
                    print_and_log('Error: Unable to get movies name from json response!')
                    print_and_log(err)
                    mv_name_ajax = None
            if mv_name_ajax is not None and mv_name_ajax != mv_name:
                mv_name_ajax = mv_name_ajax.replace('\n', '').replace('\r', '').replace('\t', '').replace('\xa0', '').strip()
                is_found = search_movies(mv_name_ajax, imdb_list, imdb_list_index)
            if not is_found:
                print_and_log('Error: << ' + mv_name + ' >>  ' + imdb_list[imdb_list_index] + ' not Found !!!')
                not_found_count += 1
                continue
        imdb_set.add(imdb_list_index)
        not_found_count = 0
    print_and_log('-----------------Finish All!--------------------')


if __name__ == '__main__':
    try:
        main()
    except Exception as err:
        print_and_log('Error in main func!!!')
        print_and_log(err)
        traceback.print_exc()
        cursor.close()
        conn.close()
    else:
        cursor.close()
        conn.close()
